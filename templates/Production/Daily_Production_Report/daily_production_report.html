{% extends 'Master/Base/base.html' %}
{% load static %}

{% block content %}

<!-- Custom CSS -->
<link rel="stylesheet" href="{% static 'css/daily_production_report.css' %}">

<!-- Add jsPDF and autoTable libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

<body>
    <div class="page-header">
        <h1>Daily Production Report</h1>
        <div class="date-info" id="reportDate"></div>
    </div>

    <!-- Filter Section -->
    <div class="filter-section">
        <form method="GET" action="{% url 'daily_production_report' %}"
            style="display: flex; gap: 20px; align-items: center; flex: 1;">
            <label for="reportDateFilter">Select Date:</label>
            <input type="date" id="reportDateFilter" name="date" value="{{ selected_date }}" />
            <button type="submit">Filter</button>
            <a href="{% url 'daily_production_report' %}" style="text-decoration: none;">
                <button type="button">Show All</button>
            </a>
        </form>

        <!-- Export Actions -->
        <div class="export-actions">
            <button type="button" onclick="generatePDF()" class="export-btn pdf-btn" title="Download PDF">
                <i class="fa-solid fa-file-pdf"></i>
            </button>
            <button type="button" onclick="printReport()" class="export-btn print-btn" title="Print Report">
                <i class="fa-solid fa-print"></i>
            </button>
        </div>
    </div>

    <div class="table-container">
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>S.No</th>
                        <th>Die No</th>
                        <th>Section No</th>
                        <th>Section Name</th>
                        <th>Cavity</th>
                        <th>Start Time</th>
                        <th>End Time</th>
                        <th>Billet Size</th>
                        <th>No of Billet</th>
                        <th>Input</th>
                        <th>Cut Length</th>
                        <th>WT per Piece</th>
                        <th>No of OK PCS</th>
                        <th>Output</th>
                        <th>Recovery %</th>
                        <th>NOP BP</th>
                        <th>NOP BA</th>
                        <th>NRT (hrs)</th>
                    </tr>
                </thead>
                <tbody id="reportTableBody">
                    {% if report_data %}
                    {% for report in report_data %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ report.die_no|default:"-" }}</td>
                        <td>{{ report.section_no|default:"-" }}</td>
                        <td>{{ report.section_name|default:"-" }}</td>
                        <td>{{ report.cavity|default:"-" }}</td>
                        <td>{{ report.start_time|time:"H:i"|default:"-" }}</td>
                        <td>{{ report.end_time|time:"H:i"|default:"-" }}</td>
                        <td>{{ report.billet_size|default:"-" }}</td>
                        <td>{{ report.no_of_billet|default:"-" }}</td>
                        <td>{{ report.input_qty|floatformat:2|default:"-" }}</td>
                        <td>{{ report.cut_length|default:"-" }}</td>
                        <td>{{ report.wt_per_piece|floatformat:2|default:"-" }}</td>
                        <td>{{ report.no_of_pieces|default:"-" }}</td>
                        <td>{{ report.total_output|floatformat:2|default:"-" }}</td>
                        <td class="calculated-field" data-output="{{ report.total_output }}"
                            data-input="{{ report.input_qty }}">-</td>
                        <td>{{ report.nop_bp|default:"-" }}</td>
                        <td>{{ report.nop_ba|default:"-" }}</td>
                        <td class="calculated-field" data-start="{{ report.start_time|time:'H:i' }}"
                            data-end="{{ report.end_time|time:'H:i' }}">-</td>
                    </tr>
                    {% endfor %}
                    {% else %}
                    <tr>
                        <td colspan="18" class="no-data">No production data available for the selected date.</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Custom JS -->
    <script src="{% static 'js/daily_production_report.js' %}"></script>
</body>
{% endblock %}