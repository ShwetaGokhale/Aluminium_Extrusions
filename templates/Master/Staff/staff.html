{% extends "Master/Base/base.html" %}
{% block content %}
{% load static %}

<!-- Custom CSS -->
<link rel="stylesheet" href="{% static 'Css/staff.css' %}">

<!-- Popup Notification -->
<div id="popupMessage" class="popup-message hidden"></div>

<div class="form-container">
    <h3 class="text-2xl font-bold italic mb-4 text-center" style="color: #1e3a8a;">
        {% if edit_mode %}Edit Staff{% else %}Staff Form{% endif %}
    </h3>

    <form id="staffForm" method="post"
        action="{% if edit_mode %}{% url 'staff_edit' staff.id %}{% else %}{% url 'staff_form' %}{% endif %}">
        {% csrf_token %}

        {% if edit_mode %}
        <input type="hidden" name="staff_id" value="{{ staff.id }}">
        {% endif %}

        <!-- Staff ID (Auto-generated, Read-only) -->
        <div>
            <label for="staff_id_display">Staff ID <span class="auto-gen-label">(Auto-generated)</span></label>
            <input type="text" id="staff_id_display" 
                value="{% if edit_mode %}{{ staff.staff_id }}{% else %}{{ next_staff_id }}{% endif %}" 
                readonly
                style="background-color: #f0f0f0; cursor: not-allowed; font-weight: 600; color: #4a5568;">
        </div>

        <!-- Date -->
        <div>
            <label for="date">Date <span style="color: red;">*</span></label>
            <input type="date" name="date" id="date" required
                value="{% if edit_mode %}{{ staff.date|date:'Y-m-d' }}{% endif %}">
        </div>

        <!-- Staff Register No -->
        <div>
            <label for="staff_register_no">Staff Register No <span style="color: red;">*</span></label>
            <input type="text" name="staff_register_no" id="staff_register_no" required 
                   value="{% if edit_mode %}{{ staff.staff_register_no }}{% endif %}"
                   placeholder="Enter staff register number">
        </div>

        <!-- First Name -->
        <div>
            <label for="first_name">First Name <span style="color: red;">*</span></label>
            <input type="text" name="first_name" id="first_name" required 
                   value="{% if edit_mode %}{{ staff.first_name }}{% endif %}"
                   placeholder="Enter first name">
        </div>

        <!-- Last Name -->
        <div>
            <label for="last_name">Last Name <span style="color: red;">*</span></label>
            <input type="text" name="last_name" id="last_name" required 
                   value="{% if edit_mode %}{{ staff.last_name }}{% endif %}"
                   placeholder="Enter last name">
        </div>

        <!-- Contact No -->
        <div>
            <label for="contact_no">Contact No <span style="color: red;">*</span></label>
            <input type="text" name="contact_no" id="contact_no" required 
                   value="{% if edit_mode %}{{ staff.contact_no }}{% endif %}"
                   placeholder="Enter contact number">
        </div>

        <!-- Designation -->
        <div>
            <label for="designation">Designation <span style="color: red;">*</span></label>
            <select name="designation" id="designation" required>
                <option value="">Select Designation</option>
                <option value="Worker" {% if edit_mode and staff.designation == 'Worker' %}selected{% endif %}>Worker</option>
                <option value="Machine Operator" {% if edit_mode and staff.designation == 'Machine Operator' %}selected{% endif %}>Machine Operator</option>
                <option value="Supervisor" {% if edit_mode and staff.designation == 'Supervisor' %}selected{% endif %}>Supervisor</option>
            </select>
        </div>

        <!-- Shift Assigned -->
        <div>
            <label for="shift_assigned">Shift Assigned <span style="color: red;">*</span></label>
            <select name="shift_assigned" id="shift_assigned" required>
                <option value="">Select Shift</option>
                <option value="Morning" {% if edit_mode and staff.shift_assigned == 'Morning' %}selected{% endif %}>Morning</option>
                <option value="Night" {% if edit_mode and staff.shift_assigned == 'Night' %}selected{% endif %}>Night</option>
            </select>
        </div>

        <!-- Assigned To Press -->
        <div>
            <label for="assigned_to_press">Assigned To Press</label>
            <select name="assigned_to_press" id="assigned_to_press">
                <option value="">Select Press</option>
                {% for press in company_presses %}
                <option value="{{ press.id }}" 
                    {% if edit_mode and staff.assigned_to_press and staff.assigned_to_press.id == press.id %}selected{% endif %}>
                    <!-- {{ press.company.name }} - {{ press.name }} -->
                    {{ press.name}}
                </option>
                {% endfor %}
            </select>
        </div>

        <!-- Address -->
        <div class="full-width">
            <label for="address">Address <span style="color: red;">*</span></label>
            <textarea name="address" id="address" rows="3" required 
                      placeholder="Enter address">{% if edit_mode %}{{ staff.address }}{% endif %}</textarea>
        </div>

        <!-- Submit Button -->
        <button type="submit">
            {% if edit_mode %}Update Staff{% else %}Save Staff{% endif %}
        </button>
    </form>
</div>

<!-- Pass data to JavaScript -->
{% if edit_mode %}
<script>
    window.editMode = true;
    window.staffId = {{ staff.id }};
    window.currentStaffId = "{{ staff.staff_id }}";
</script>
{% else %}
<script>
    window.editMode = false;
    window.nextStaffId = "{{ next_staff_id }}";
</script>
{% endif %}

<!-- JavaScript -->
<script src="{% static 'Js/staff.js' %}"></script>

<style>
    .auto-gen-label {
        font-size: 0.75rem;
        color: #718096;
        font-style: italic;
        font-weight: normal;
    }
</style>

{% endblock %}