{% extends "Master/Base/base.html" %}
{% block content %}
{% load static %}

<!-- Custom CSS -->
<link rel="stylesheet" href="{% static 'css/supplier.css' %}">

<!-- Popup Notification -->
<div id="popupMessage" class="popup-message hidden"></div>

<div class="form-container">
    <h3 class="text-2xl font-bold italic mb-4 text-center" style="color: #1e3a8a;">
        {% if edit_mode %}Edit Supplier{% else %}Supplier Form{% endif %}
    </h3>

    <form id="supplierForm" method="post"
        action="{% if edit_mode %}{% url 'supplier_edit' supplier.id %}{% else %}{% url 'supplier' %}{% endif %}">
        {% csrf_token %}

        {% if edit_mode %}
        <input type="hidden" name="supplier_id" value="{{ supplier.id }}">
        {% endif %}

        <!-- Supplier ID (Auto-generated, Read-only) -->
        <div>
            <label for="supplier_id_display">Supplier ID <span class="auto-gen-label">(Auto-generated)</span></label>
            <input type="text" id="supplier_id_display" 
                value="{% if edit_mode %}{{ supplier.supplier_id }}{% else %}{{ next_supplier_id }}{% endif %}" 
                readonly
                style="background-color: #f0f0f0; cursor: not-allowed; font-weight: 600; color: #4a5568;">
        </div>

        <!-- Date (Auto-filled, Non-editable) -->
        <div>
            <label for="date">Date <span class="auto-gen-label">(Auto-filled)</span></label>
            <input type="date" name="date" id="date"
                value="{% if edit_mode %}{{ supplier.date|date:'Y-m-d' }}{% endif %}"
                readonly
                style="background-color: #f0f0f0; cursor: not-allowed; font-weight: 600; color: #4a5568;">
        </div>

        <!-- Name - ONLY REQUIRED FIELD -->
        <div>
            <label for="name">Name <span style="color: red;">*</span></label>
            <input type="text" name="name" id="name" required 
                   value="{% if edit_mode %}{{ supplier.name }}{% endif %}"
                   placeholder="Enter supplier name">
        </div>

        <!-- Supplier Type -->
        <div>
            <label for="supplier_type">Supplier Type</label>
            <select name="supplier_type" id="supplier_type">
                <option value="">Select Type</option>
                <option value="Die Supplier" {% if edit_mode and supplier.supplier_type == 'Die Supplier' %}selected{% endif %}>Die Supplier</option>
                <option value="Raw Material" {% if edit_mode and supplier.supplier_type == 'Raw Material' %}selected{% endif %}>Raw Material</option>
                <option value="Billets" {% if edit_mode and supplier.supplier_type == 'Billets' %}selected{% endif %}>Billets</option>
                <option value="Ingots" {% if edit_mode and supplier.supplier_type == 'Ingots' %}selected{% endif %}>Ingots</option>
                <option value="Parts" {% if edit_mode and supplier.supplier_type == 'Parts' %}selected{% endif %}>Parts</option>
                <option value="Service" {% if edit_mode and supplier.supplier_type == 'Service' %}selected{% endif %}>Service</option>
            </select>
        </div>

        <!-- Contact No -->
        <div>
            <label for="contact_no">Contact No</label>
            <input type="text" name="contact_no" id="contact_no"
                   value="{% if edit_mode %}{{ supplier.contact_no }}{% endif %}"
                   placeholder="Enter contact number">
        </div>

        <!-- Supplier Contact Person -->
        <div>
            <label for="contact_person">Supplier Contact Person</label>
            <input type="text" name="contact_person" id="contact_person" 
                   value="{% if edit_mode %}{{ supplier.contact_person }}{% endif %}"
                   placeholder="Enter contact person name">
        </div>

        <!-- Address -->
        <div class="full-width">
            <label for="address">Address</label>
            <textarea name="address" id="address" rows="3"
                      placeholder="Enter address">{% if edit_mode %}{{ supplier.address }}{% endif %}</textarea>
        </div>

        <!-- Submit Button -->
        <button type="submit">
            {% if edit_mode %}Update Supplier{% else %}Save Supplier{% endif %}
        </button>
    </form>
</div>

<!-- Pass data to JavaScript -->
{% if edit_mode %}
<script>
    window.editMode = true;
    window.supplierId = {{ supplier.id }};
    window.currentSupplierId = "{{ supplier.supplier_id }}";
</script>
{% else %}
<script>
    window.editMode = false;
    window.nextSupplierId = "{{ next_supplier_id }}";
</script>
{% endif %}

<!-- JavaScript -->
<script src="{% static 'js/supplier.js' %}"></script>

<style>
    .auto-gen-label {
        font-size: 0.75rem;
        color: #718096;
        font-style: italic;
        font-weight: normal;
    }
</style>

{% endblock %}