{% extends 'Master/Base/base.html' %}
{% load static %}

{% block content %}
<style>
    /* === GLOBAL RESET === */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    /* === MAIN DASHBOARD CONTAINER === */
    .dashboard-container {
        padding: 0;
        background: #f8f9fa;
        min-height: 100vh;
        font-family: 'Inter', sans-serif;
        opacity: 0;
        transform: translateY(20px);
        animation: dashFadeSlide 0.7s cubic-bezier(0.22, 1, 0.36, 1) forwards;
    }

    @keyframes dashFadeSlide {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* STAGGER CARDS: TOP STATS */
    .top-stats .stat-card {
        opacity: 0;
        transform: translateY(20px);
        animation: cardStagger 0.7s cubic-bezier(0.22, 1, 0.36, 1) forwards;
    }

    .top-stats .stat-card:nth-child(1) {
        animation-delay: 0.15s;
    }

    .top-stats .stat-card:nth-child(2) {
        animation-delay: 0.28s;
    }

    .top-stats .stat-card:nth-child(3) {
        animation-delay: 0.41s;
    }

    @keyframes cardStagger {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* TABS SECTION SMOOTH LIFT */
    .tabs-section {
        opacity: 0;
        transform: translateY(30px);
        animation: sectionRise 0.8s ease-out forwards;
        animation-delay: 0.55s;
    }

    @keyframes sectionRise {
        from {
            opacity: 0;
            transform: translateY(30px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* TABLES SLIDE UP */
    .tables-section {
        opacity: 0;
        transform: translateY(35px);
        animation: tableAppear 1s ease-out forwards;
        animation-delay: 0.7s;
    }

    @keyframes tableAppear {
        from {
            opacity: 0;
            transform: translateY(35px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* === LOGO TEXT === */
    .logo {
        font-size: 20px;
        font-weight: bold;
        color: #343a40;
    }

    /* === HEADER (STICKY TOP BAR) === */
    .dashboard-header {
        position: sticky;
        top: 0;
        z-index: 1000;
        background: #ffffff;
        padding: 20px 30px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    /* Right side of header: calendar icon + filters */
    .header-right {
        display: flex;
        align-items: center;
        gap: 20px;
    }

    /* === FILTER BUTTON GROUP === */
    .filter-buttons {
        display: flex;
        gap: 10px;
        background: white;
        padding: 6px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    /* Each filter button */
    .filter-btn {
        padding: 8px 20px;
        border: none;
        background: transparent;
        color: #64748b;
        font-size: 14px;
        font-weight: 500;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
        transition: background 0.3s, color 0.3s, transform 0.3s ease, box-shadow 0.3s ease;
    }

    /* Hover effect on filter buttons */
    .filter-btn:hover {
        background: #f1f5f9;
        color: #1e293b;
        transform: translateY(-4px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
    }

    /* Active selected filter button */
    .filter-btn.active {
        background: #3b82f6;
        color: white;
        transform: translateY(0);
        /* active stays flat */
    }

    /* Calendar icon style */
    .fa-calendar-alt {
        color: #64748b;
        transition: color 0.3s, transform 0.3s ease;
    }

    .fa-calendar-alt:hover {
        color: #3b82f6;
        transform: translateY(-4px);
    }

    /* === MAIN CONTENT AREA === */
    .dashboard-content {
        padding: 30px;
    }

    /* === TOP THREE CARDS LAYOUT === */
    .top-stats {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin-bottom: 30px;
    }

    /* Each top card */
    .stat-card {
        background: white;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        position: relative;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 12px 28px rgba(0, 0, 0, 0.12);
    }

    /* Title row inside card */
    .stat-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    /* Card title text + icon */
    .stat-title {
        display: flex;
        align-items: center;
        gap: 10px;
        color: #64748b;
        font-size: 14px;
        font-weight: 500;
    }

    .stat-title i {
        color: #3b82f6;
        font-size: 18px;
    }

    /* Expand icon */
    .expand-icon {
        color: #94a3b8;
        cursor: pointer;
    }

    /* Values inside cards laid out horizontally */
    .stat-content {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: nowrap;
        gap: 20px;
    }

    .stat-item {
        text-align: center;
        flex-shrink: 0;
    }

    .stat-value {
        font-size: 18px;
        font-weight: 700;
        color: #1e293b;
        display: block;
    }

    .stat-label {
        font-size: 13px;
        color: #64748b;
        margin-top: 4px;
    }

    /* === PRODUCTION CARD SPECIAL STYLING === */
    .production-stats {
        display: flex;
        gap: 70px;
        align-items: center;
        justify-content: space-around;
    }

    .prod-stat {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    .prod-value {
        font-size: 18px;
        font-weight: 700;
        color: #1e293b;
    }

    .prod-label {
        font-size: 12px;
        color: #64748b;
        margin-top: 2px;
    }

    /* === TABLES SECTION === */
    .tables-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
    }

    /* Table card container */
    .table-card {
        background: white;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }


    .table-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 12px 28px rgba(0, 0, 0, 0.12);
    }

    /* Production table uses full width */
    .table-card.full-width {
        grid-column: 1 / -1;
    }

    /* Title bar inside table card */
    .table-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    /* Table title text + icon */
    .table-title {
        font-size: 16px;
        font-weight: 600;
        color: #1e293b;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .table-title i {
        color: #3b82f6;
    }

    /* Table element */
    .data-table {
        width: 100%;
        border-collapse: collapse;
    }

    /* Table header row */
    .data-table thead {
        background: #f8f9fa;
    }

    .data-table th {
        padding: 12px 16px;
        text-align: left;
        font-size: 13px;
        font-weight: 600;
        color: #64748b;
        border-bottom: 2px solid #e2e8f0;
    }

    /* Table body cells */
    .data-table td {
        padding: 14px 16px;
        font-size: 13px;
        color: #1e293b;
        border-bottom: 1px solid #e2e8f0;
    }

    .data-table tbody tr:hover {
        background: #f8f9fa;
    }

    /* Remove last bottom border */
    .data-table tbody tr:last-child td {
        border-bottom: none;
    }

    /* Table badges (complete, pending, etc.) */
    .status-badge {
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
        display: inline-block;
    }

    .status-badge.completed {
        background: #d1fae5;
        color: #059669;
    }

    .status-badge.pending {
        background: #fef3c7;
        color: #d97706;
    }

    .status-badge.cancelled {
        background: #fee2e2;
        color: #dc2626;
    }

    .status-badge.running {
        background: #dbeafe;
        color: #2563eb;
    }

    .status-badge.idle {
        background: #f3f4f6;
        color: #6b7280;
    }

    /* === TABS SECTION (OEE, Downtime, etc.) === */
    .tabs-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
    }

    .tab-card {
        background: white;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .tab-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 12px 28px rgba(0, 0, 0, 0.12);
    }

    /* Tab buttons */
    .tabs {
        display: flex;
        gap: 20px;
        margin-bottom: 30px;
        border-bottom: 2px solid #e2e8f0;
        padding-bottom: 0;
    }

    .tab {
        padding: 12px 0;
        color: #64748b;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        margin-bottom: -2px;
        font-weight: 500;
        transition: all 0.3s;
    }

    .tab.active {
        color: #3b82f6;
        border-bottom-color: #3b82f6;
    }

    .tab:hover {
        color: #3b82f6;
    }

    /* Plant Cards */
    .plants-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
    }

    .plant-card {
        text-align: center;
    }

    .plant-circle {
        width: 120px;
        height: 120px;
        margin: 0 auto 15px;
        position: relative;
    }

    .plant-name {
        font-weight: 600;
        color: #1e293b;
        margin-bottom: 8px;
    }

    .plant-trend {
        font-size: 13px;
        font-weight: 600;
    }

    .plant-trend.up {
        color: #10b981;
    }

    .plant-trend.down {
        color: #ef4444;
    }


    /* Recovery Card */
    .recovery-card {
        padding: 20px;
    }

    /* === RECOVERY SIDE CARD === */
    .recovery-header {
        display: flex;
        align-items: center;
        gap: 8px;
        justify-content: flex-start;
        margin-bottom: 20px;
    }

    .recovery-percentage {
        font-size: 40px;
        font-weight: 700;
        color: #1e293b;
        text-align: left;
        margin-bottom: 30px;
        padding-left: 0px;
    }

    .recovery-chart {
        display: flex;
        justify-content: center;
        align-items: flex-end;
        gap: 30px;
        height: 140px;
        position: relative;
        padding-left: 20px;
    }

    .recovery-bar {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        flex: 1;
        max-width: 80px;
    }

    .recovery-bar-container {
        width: 100%;
        height: 100px;
        position: relative;
        display: flex;
        align-items: flex-end;
        border-bottom: 3px solid #cbd5e1;
    }

    .recovery-bar-fill {
        width: 100%;
        position: relative;
        border-radius: 4px 4px 0 0;
    }

    .recovery-bar-fill.today {
        height: 90%;
        background: linear-gradient(180deg, rgba(251, 191, 36, 0.3) 0%, rgba(251, 191, 36, 0.4) 100%);
        border: 2px solid rgba(251, 191, 36, 0.5);
        border-bottom: none;
    }

    .recovery-bar-fill.yesterday {
        height: 90%;
        background: linear-gradient(180deg, rgba(239, 68, 68, 0.15) 0%, rgba(239, 68, 68, 0.25) 100%);
        border: 2px solid rgba(239, 68, 68, 0.4);
        border-bottom: none;
    }

    .recovery-bar-label {
        font-size: 13px;
        color: #64748b;
        font-weight: 500;
        margin-top: 5px;
    }

    /* Responsive */
    @media (max-width: 1400px) {
        .top-stats {
            grid-template-columns: repeat(2, 1fr);
        }

        .tables-section {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 768px) {

        .top-stats,
        .tabs-section {
            grid-template-columns: 1fr;
        }

        .plants-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    /* === CALENDAR POPUP STYLING === */
    .calendar-popup {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: calc(100vh - 70px);
        /* reduce footer height */
        margin-top: 35px;
        /* half of footer height to center properly */
        display: none;
        justify-content: center;
        align-items: center;
        backdrop-filter: blur(6px);
        background: rgba(255, 255, 255, 0.1);
        z-index: 2000;
    }


    /* When active, display */
    .calendar-popup.active {
        display: flex;
    }

    /* Glassy calendar box */
    .calendar-container {
        width: 380px;
        background: rgba(255, 255, 255, 0.7);
        padding: 25px;
        border-radius: 18px;
        backdrop-filter: blur(25px);
        box-shadow: 0 8px 35px rgba(0, 0, 0, 0.15);
        animation: fadeIn 0.2s ease-out;
        position: relative;
    }

    /* Close button at top-right of entire screen */
    .calendar-close {
        position: fixed;
        top: 20px;
        right: 25px;
        width: 38px;
        height: 38px;
        border-radius: 50%;
        border: none;
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(8px);
        cursor: pointer;
        font-size: 20px;
        font-weight: 600;
        color: #1e293b;
        box-shadow: 0 4px 14px rgba(0, 0, 0, 0.15);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 4000;
        /* stays above everything */
        transition: 0.25s;
    }

    .calendar-close:hover {
        transform: scale(1.12);
        background: #ffffff;
    }


    /* Calendar header */
    .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 18px;
    }

    .calendar-month-year {
        font-size: 20px;
        font-weight: 600;
        color: #1e293b;
    }

    /* Prev/next buttons */
    .calendar-nav button {
        background: #e2e8f0;
        border: none;
        width: 34px;
        height: 34px;
        border-radius: 8px;
        font-size: 14px;
        cursor: pointer;
        color: #475569;
        transition: 0.2s;
    }

    .calendar-nav button:hover {
        background: #cbd5e1;
        transform: scale(1.05);
    }

    /* Calendar grid (days layout) */
    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 8px;
    }

    /* Day name headers */
    .calendar-day-header {
        text-align: center;
        font-size: 12px;
        font-weight: 600;
        color: #64748b;
        margin-bottom: 4px;
    }

    /* Day buttons */
    .calendar-day {
        padding: 10px 0;
        text-align: center;
        font-size: 14px;
        cursor: pointer;
        border-radius: 10px;
        transition: 0.2s;
        color: #334155;
    }

    .calendar-day:hover {
        background: #e2e8f0;
    }

    /* Today highlight */
    .calendar-day.today {
        background: #3b82f6;
        color: white;
        font-weight: 700;
        box-shadow: 0 2px 8px rgba(59, 130, 246, 0.4);
    }

    /* Selected date highlight */
    .calendar-day.selected {
        background: #0ea5e9;
        color: white;
        font-weight: 700;
        box-shadow: 0 3px 10px rgba(14, 165, 233, 0.35);
    }

    /* Days of previous/next month */
    .calendar-day.other-month {
        color: #cbd5e1;
    }

    /* Fade-in animation for calendar */
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* === ALIVE ICON ANIMATION === */
    .alive-icon {
        display: inline-block;
        font-size: 22px;
        color: black;
        animation: iconBreath 2.6s ease-in-out infinite,
            iconGlow 2.6s ease-in-out infinite;
        transform-origin: center;
    }

    /* Smooth breathing (scale in-out) */
    @keyframes iconBreath {
        0% {
            transform: scale(1);
        }

        50% {
            transform: scale(1.12);
        }

        100% {
            transform: scale(1);
        }
    }

    /* Soft glowing effect */
    @keyframes iconGlow {
        0% {
            text-shadow: 0 0 0px rgba(59, 130, 246, 0.5);
        }

        50% {
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.75);
        }

        100% {
            text-shadow: 0 0 0px rgba(59, 130, 246, 0.5);
        }
    }

    /* === PRODUCTION CARD UNIT STYLING === */
    .prod-value .unit {
        font-size: 15px;
        /* smaller text */
        margin-left: 2px;
        /* small space */
        color: #64748b;
        /* softer color */
        font-weight: 500;
    }

    /* === STAT CARD UNIT STYLING === */
    .stat-value .unit {
        font-size: 12px;
        margin-left: 2px;
        font-weight: 500;
        color: #64748b;
    }

    /* === RECOVERY CARD STYLING === */
    .recovery-good {
        color: #10b981 !important;
        /* green */
    }

    .recovery-bad {
        color: #ef4444 !important;
        /* red */
    }

    /* === ORDER CARD STYLING === */
    .order-blue {
        color: #3b82f6 !important;
        /* blue */
    }

    .order-green {
        color: #10b981 !important;
        /* green */
    }

    .order-yellow {
        color: #f59e0b !important;
        /* yellow */
    }

    .order-red {
        color: #ef4444 !important;
        /* red */
    }
</style>

<div class="dashboard-container">
    <!-- ===========================ðŸ”µ STICKY HEADER Contains: Logo, Calendar Icon, Filter Buttons ============================ -->
    <div class="dashboard-header">
        <div class="logo">
            <i class="fas fa-chart-line alive-icon"></i> Production Dashboard
        </div>
        <div class="header-right">
            <!-- Calendar popup trigger -->
            <i class="fas fa-calendar-alt" style="font-size: 18px; cursor: pointer;" onclick="toggleCalendar()"></i>

            <!-- Today / Weekly / Monthly filter buttons -->
            <div class="filter-buttons">
                <button class="filter-btn active" onclick="setFilter('today')">Today</button>
                <button class="filter-btn" onclick="setFilter('weekly')">Weekly</button>
                <button class="filter-btn" onclick="setFilter('monthly')">Monthly</button>
            </div>
        </div>
    </div>

    <!-- =========================== ðŸ”µ CALENDAR POPUP OVERLAY ,Appears when clicking calendar icon ============================ -->
    <div class="calendar-popup" id="calendarPopup" onclick="closeCalendarOnOutsideClick(event)">

        <!-- Close button: positioned at TOP RIGHT OF SCREEN -->
        <button class="calendar-close" onclick="toggleCalendar()">Ã—</button>

        <!-- Calendar Box -->
        <div class="calendar-container" onclick="event.stopPropagation()">

            <!-- Month / Year + Prev/Next buttons -->
            <div class="calendar-header">
                <div class="calendar-month-year" id="monthYear"></div>

                <div class="calendar-nav">
                    <button onclick="changeMonth(-1)">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button onclick="changeMonth(1)">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <!-- Day Name Grid -->
            <div class="calendar-grid">
                <div class="calendar-day-header">Sun</div>
                <div class="calendar-day-header">Mon</div>
                <div class="calendar-day-header">Tue</div>
                <div class="calendar-day-header">Wed</div>
                <div class="calendar-day-header">Thu</div>
                <div class="calendar-day-header">Fri</div>
                <div class="calendar-day-header">Sat</div>
            </div>

            <!-- Actual Calendar Dates (filled by JS) -->
            <div class="calendar-grid" id="calendarDays"></div>
        </div>
    </div>


    <!-- =========================== ðŸ”µ DASHBOARD MAIN CONTENT ============================ -->
    <div class="dashboard-content">

        <!-- =========================== ðŸ”µ TOP THREE CARDS (Recovery, Production, Orders) ============================ -->
        <div class="top-stats">

            <!-- ========== CARD 1: RECOVERY DETAILS ========== -->
            <div class="stat-card">

                <!-- Card Header -->
                <div class="stat-header">
                    <div class="stat-title">
                        <i class="fa-solid fa-arrow-trend-up"></i>
                        Recovery Details
                    </div>
                    <i class="fa-solid fa-up-right-from-square expand-icon"></i>
                </div>

                <!-- Card Values -->
                <div class="stat-content" style="justify-content: space-around; flex-wrap: nowrap;">

                    <div class="stat-item">
                        <span class="stat-value">87%</span>
                        <span class="stat-label">Recovery</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">2</span>
                        <span class="stat-label">Press</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">370<span class="unit">kg</span></span>
                        <span class="stat-label">Input</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">560<span class="unit">kg</span></span>
                        <span class="stat-label">Output</span>
                    </div>
                </div>
            </div>

            <!-- ========== CARD 2: PRODUCTION ========== -->
            <div class="stat-card">

                <div class="stat-header">
                    <div class="stat-title">
                        <i class="fa-solid fa-gears"></i>
                        Production
                    </div>
                    <i class="fa-solid fa-up-right-from-square expand-icon"></i>
                </div>

                <!-- Production Stats Values -->
                <div class="production-stats">
                    <div class="prod-stat">
                        <span class="prod-value">3675<span class="unit">ft</span></span>
                        <span class="prod-label">Length</span>
                    </div>
                    <div class="prod-stat">
                        <span class="prod-value">1600<span class="unit">ft</span></span>
                        <span class="prod-label">16ft C/L</span>
                    </div>
                    <div class="prod-stat">
                        <span class="prod-value">1672<span class="unit">ft</span></span>
                        <span class="prod-label">12ft C/L</span>
                    </div>
                </div>
            </div>

            <!-- ========== CARD 3: ORDER SUMMARY ========== -->
            <div class="stat-card">

                <div class="stat-header">
                    <div class="stat-title">
                        <i class="fa-solid fa-list-check"></i>
                        Order
                    </div>
                    <i class="fa-solid fa-up-right-from-square expand-icon"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-item">
                        <span class="stat-value">32</span>
                        <span class="stat-label">Orders</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">16</span>
                        <span class="stat-label">Completed</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">8</span>
                        <span class="stat-label">Pending</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">4</span>
                        <span class="stat-label">Cancelled</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- =========================== ðŸ”µ TABS SECTION (OEE, Downtime, Productionâ€¦) ============================ -->
        <div class="tabs-section">

            <!-- Left Tab Card -->
            <div class="tab-card">

                <!-- Tab Buttons -->
                <div class="tabs">
                    <div class="tab active">OEE</div>
                    <div class="tab">Downtime</div>
                    <div class="tab">Production</div>
                    <div class="tab">Production Rate</div>
                    <div class="tab">Quality</div>
                    <div class="tab">Utilization</div>
                </div>

                <!-- Plant Circular Progress Cards -->
                <div class="plants-grid">

                    <!-- Plant 1 -->
                    <div class="plant-card">
                        <div class="plant-circle">
                            <canvas id="plant1Chart"></canvas>
                        </div>
                        <div class="plant-name">Plant - 1</div>
                        <div class="plant-trend up">â†‘ 5%</div>
                    </div>

                    <!-- Plant 2 -->
                    <div class="plant-card">
                        <div class="plant-circle">
                            <canvas id="plant2Chart"></canvas>
                        </div>
                        <div class="plant-name">Plant - 2</div>
                        <div class="plant-trend up">â†‘ 13%</div>
                    </div>

                    <!-- Plant 3 -->
                    <div class="plant-card">
                        <div class="plant-circle">
                            <canvas id="plant3Chart"></canvas>
                        </div>
                        <div class="plant-name">Plant - 3</div>
                        <div class="plant-trend down">â†“ 8%</div>
                    </div>

                    <!-- Plant 4 -->
                    <div class="plant-card">
                        <div class="plant-circle">
                            <canvas id="plant4Chart"></canvas>
                        </div>
                        <div class="plant-name">Plant - 4</div>
                        <div class="plant-trend down">â†“ 18%</div>
                    </div>
                </div>
            </div>

            <!-- RIGHT SIDE RECOVERY CARD -->
            <div class="tab-card">

                <!-- Recovery -->
                <div class="recovery-card" style="max-width: 400px;">
                    <div class="recovery-header">
                        <i class="fa-solid fa-arrow-trend-up" style="color: #64748b; font-size: 16px;"></i>
                        <span style="color: #64748b; font-size: 18px; font-weight: 500;">Recovery</span>
                    </div>
                    <div class="recovery-percentage">87%</div>
                    <div class="recovery-chart">
                        <div class="recovery-bar">
                            <div class="recovery-bar-container">
                                <div class="recovery-bar-fill today"></div>
                            </div>
                            <div class="recovery-bar-label">Today</div>
                        </div>
                        <div class="recovery-bar">
                            <div class="recovery-bar-container">
                                <div class="recovery-bar-fill yesterday"></div>
                            </div>
                            <div class="recovery-bar-label">Yesterday</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- =========================== ðŸ”µ TABLES SECTION (Recovery / Orders / Production) ============================ -->
        <div class="tables-section">

            <!-- Recovery Table -->
            <div class="table-card">
                <div class="table-header">
                    <div class="table-title">
                        <i class="fa-solid fa-table-list"></i>
                        Recovery Table
                    </div>
                </div>

                <!-- =========ðŸ”µ Data Table========== -->
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Die No</th>
                            <th>Cavity</th>
                            <th>Press</th>
                            <th>Input</th>
                            <th>Output</th>
                            <th>Recovery</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>D-001</td>
                            <td>4</td>
                            <td>Press 1</td>
                            <td>120kg</td>
                            <td>180kg</td>
                            <td>85%</td>
                        </tr>
                        <tr>
                            <td>D-002</td>
                            <td>6</td>
                            <td>Press 2</td>
                            <td>150kg</td>
                            <td>220kg</td>
                            <td>88%</td>
                        </tr>
                        <tr>
                            <td>D-003</td>
                            <td>8</td>
                            <td>Press 1</td>
                            <td>100kg</td>
                            <td>160kg</td>
                            <td>92%</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- ========ðŸ”µ ORDER TABLE ========== -->
            <div class="table-card">
                <div class="table-header">
                    <div class="table-title">
                        <i class="fa-solid fa-list-check"></i>
                        Order Table
                    </div>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Order No</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>ORD-2024-001</td>
                            <td><span class="status-badge completed">Completed</span></td>
                        </tr>
                        <tr>
                            <td>ORD-2024-002</td>
                            <td><span class="status-badge pending">Pending</span></td>
                        </tr>
                        <tr>
                            <td>ORD-2024-003</td>
                            <td><span class="status-badge completed">Completed</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- ==== ðŸ”µ PRODUCTION TABLE ==== -->
            <div class="table-card full-width">
                <div class="table-header">
                    <div class="table-title">
                        <i class="fa-solid fa-table-cells-large"></i>
                        Production Table
                    </div>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Die No</th>
                            <th>C/L</th>
                            <th>Operator</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>D-001</td>
                            <td>16ft</td>
                            <td>John Smith</td>
                            <td><span class="status-badge running">Running</span></td>
                        </tr>
                        <tr>
                            <td>D-002</td>
                            <td>12ft</td>
                            <td>Mike Johnson</td>
                            <td><span class="status-badge running">Running</span></td>
                        </tr>
                        <tr>
                            <td>D-003</td>
                            <td>16ft</td>
                            <td>Sarah Williams</td>
                            <td><span class="status-badge idle">Idle</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>

<script>
    // â–¶ Auto color recovery %
    document.querySelectorAll('.stat-item .stat-value').forEach(item => {
        let text = item.innerText.trim();

        // check if it ends with %
        if (text.endsWith("%")) {
            let num = parseFloat(text.replace("%", ""));

            if (num >= 80) {
                item.classList.add("recovery-good");
            } else {
                item.classList.add("recovery-bad");
            }
        }
    });

    // â–¶ Auto color ORDER summary (Orders / Completed / Pending / Cancelled)
    document.querySelectorAll('.stat-card .stat-content .stat-item').forEach(item => {
        let label = item.querySelector('.stat-label')?.innerText.trim().toLowerCase();
        let valueSpan = item.querySelector('.stat-value');

        if (!label || !valueSpan) return;

        if (label === "orders") {
            valueSpan.classList.add("order-blue");
        }
        else if (label === "completed") {
            valueSpan.classList.add("order-green");
        }
        else if (label === "pending") {
            valueSpan.classList.add("order-yellow");
        }
        else if (label === "cancelled") {
            valueSpan.classList.add("order-red");
        }
    });


    // Filter functionality
    function setFilter(filter) {
        // Remove active class from all buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
        });

        // Add active class to clicked button
        event.target.classList.add('active');

        // Here you can add logic to filter data based on the selected filter
        console.log('Filter set to:', filter);
        // Add your filter logic here
    }

    let currentDate = new Date();
    let selectedDate = new Date();

    // Calendar Functions
    function toggleCalendar() {
        const popup = document.getElementById('calendarPopup');
        popup.classList.toggle('active');

        if (popup.classList.contains('active')) {
            renderCalendar();
        }
    }

    // Close calendar when clicking outside
    function closeCalendarOnOutsideClick(event) {
        if (event.target.id === 'calendarPopup') {
            toggleCalendar();
        }
    }

    // Change month
    function changeMonth(delta) {
        currentDate.setMonth(currentDate.getMonth() + delta);
        renderCalendar();
    }

    // Render calendar
    function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();

        const monthNames = [
            'January', 'February', 'March', 'April', 'May', 'June',
            'July', 'August', 'September', 'October', 'November', 'December'
        ];
        document.getElementById('monthYear').textContent =
            `${monthNames[month]} ${year}`;

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const daysInPrevMonth = new Date(year, month, 0).getDate();

        const container = document.getElementById('calendarDays');
        container.innerHTML = "";

        const today = new Date();

        // Previous month
        for (let i = firstDay - 1; i >= 0; i--) {
            let d = daysInPrevMonth - i;
            let div = document.createElement("div");
            div.className = "calendar-day other-month";
            div.textContent = d;
            container.appendChild(div);
        }

        // Current month
        for (let d = 1; d <= daysInMonth; d++) {
            let div = document.createElement("div");
            div.className = "calendar-day";
            div.textContent = d;

            if (
                d === today.getDate() &&
                year === today.getFullYear() &&
                month === today.getMonth()
            ) {
                div.classList.add("today");
            }

            div.onclick = () => selectDate(year, month, d);
            container.appendChild(div);
        }

        // Next month filler
        const cells = container.children.length;
        const remain = 42 - cells;

        for (let i = 1; i <= remain; i++) {
            let div = document.createElement("div");
            div.className = "calendar-day other-month";
            div.textContent = i;
            container.appendChild(div);
        }
    }

    // Select date
    function selectDate(year, month, day) {
        selectedDate = new Date(year, month, day);

        console.log("Selected date:", selectedDate.toDateString());

        setTimeout(() => toggleCalendar(), 200);
    }

    // === Animate Donut 1 (Plant-1) from 0 â†’ actual value ===
    function animateDonut(canvasId, finalValue, color) {
        const ctx = document.getElementById(canvasId).getContext("2d");

        let current = 0;
        let speed = finalValue / 60;   // smooth animation

        function drawFrame() {
            ctx.clearRect(0, 0, 400, 400);

            new Chart(ctx, {
                type: "doughnut",
                data: {
                    datasets: [{
                        data: [current, 100 - current],
                        backgroundColor: [color, "#e2e8f0"],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    cutout: "75%",
                    animation: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    }
                },
                plugins: [{
                    afterDraw: (chart) => {
                        const c = chart.ctx;
                        const area = chart.chartArea;
                        const x = area.left + (area.right - area.left) / 2;
                        const y = area.top + (area.bottom - area.top) / 2;

                        c.save();
                        c.font = "bold 20px Inter";
                        c.fillStyle = "#1e293b";
                        c.textAlign = "center";
                        c.textBaseline = "middle";
                        c.fillText(Math.round(current) + "%", x, y);
                        c.restore();
                    }
                }]
            });

            if (current < finalValue) {
                current += speed;
                requestAnimationFrame(drawFrame);
            }
        }

        drawFrame();
    }


    // Plant Donut Charts
    const plantCharts = [
        { id: 'plant1Chart', value: 63.79, color: '#f97316' },
        { id: 'plant2Chart', value: 95.05, color: '#3b82f6' },
        { id: 'plant3Chart', value: 86.94, color: '#3b82f6' },
        { id: 'plant4Chart', value: 75.65, color: '#f97316' }
    ];

    // Plugin to always draw center text (fixes disappearing on hover)
    const centerTextPlugin = {
        id: "centerText",
        afterDraw(chart, args, options) {
            const { ctx, chartArea: { left, right, top, bottom } } = chart;

            const centerX = left + (right - left) / 2;
            const centerY = top + (bottom - top) / 2;

            ctx.save();
            ctx.font = "bold 20px Inter";
            ctx.fillStyle = "#1e293b";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(options.text, centerX, centerY);
            ctx.restore();
        }
    };


    plantCharts.forEach(plant => {
        const canvas = document.getElementById(plant.id);
        if (!canvas) return;

        let progress = 0;
        let target = plant.value;

        const chart = new Chart(canvas, {
            type: "doughnut",
            data: {
                datasets: [{
                    data: [0, 100],
                    backgroundColor: [plant.color, "#e2e8f0"],
                    borderWidth: 0
                }]
            },
            options: {
                cutout: "75%",
                animation: false,
                plugins: {
                    legend: { display: false },
                    tooltip: { enabled: false },
                    centerText: { text: "0%" }
                }
            },
            plugins: [centerTextPlugin]
        });

        function animate() {
            progress += 1;

            chart.data.datasets[0].data = [progress, 100 - progress];
            chart.options.plugins.centerText.text = progress + "%";
            chart.update();

            if (progress < target) requestAnimationFrame(animate);
        }

        requestAnimationFrame(animate);

    });
</script>

{% endblock %}