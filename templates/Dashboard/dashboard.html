{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IOT Dashboard - OEE Monitoring</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
</head>

<body>
    <!-- Navigation Bar -->
    <div class="nav-bar">
        <!-- back button -->
        <div class="nav-item">
            <i class="fas fa-arrow-left"></i>
        </div>
        <div class="nav-item active">
            <i class="fas fa-home"></i> HOME
        </div>
        <div class="nav-item">
            <i class="fas fa-chart-line"></i> ANALYTICS
        </div>
        <div class="nav-item">
            <i class="fas fa-calendar-day"></i> DAILY
        </div>
        <div class="nav-item">
            <i class="fas fa-calendar-week"></i> WEEKLY
        </div>
        <div class="nav-item">
            <i class="fas fa-calendar"></i> MONTHLY
        </div>
        <div class="nav-item">
            <i class="fas fa-download"></i> DOWNLOADS
        </div>
    </div>

    <div class="main-container">
        <!-- Left Section -->
        <div class="left-section">
            <img src="{% static 'images/aluminium.png' %}" alt="Aluminium" class="machine-image">

            <div class="chart-card">
                <div class="chart-header">
                    <div class="chart-title">
                        <i class="fas fa-clock"></i> Machine Run Time (min)
                    </div>
                    <i class="fas fa-expand expand-icon"></i>
                </div>
                <div class="donut-chart">
                    <svg width="180" height="180">
                        <circle cx="90" cy="90" r="70" fill="none" stroke="#3b82f6" stroke-width="28"
                            stroke-dasharray="320 145" stroke-linecap="round" />
                        <circle cx="90" cy="90" r="70" fill="none" stroke="green" stroke-width="28"
                            stroke-dasharray="30 435" stroke-dashoffset="-320" stroke-linecap="round" />
                        <circle cx="90" cy="90" r="70" fill="none" stroke="#ef4444" stroke-width="28"
                            stroke-dasharray="55 410" stroke-dashoffset="-350" stroke-linecap="round" />
                    </svg>
                    <div class="donut-center">
                        <div class="donut-label">Total</div>
                        <div class="donut-value">465</div>
                    </div>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #3b82f6;"></div>
                        Run Time <span class="legend-value">366</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: green;"></div>
                        Idle Time <span class="legend-value">35</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ef4444;"></div>
                        Off Time <span class="legend-value">64</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Center Section -->
        <div class="center-section">
            <div class="top-row">
                <!-- Ordered -->
                <div class="time-card">
                    <div class="time-icon run">
                        <i class="fas fa-clipboard-list" style="font-size: 24px;"></i>
                    </div>
                    <div class="time-content">
                        <h4>Ordered</h4>
                        <div class="time-value run" id="totalOrdered">{{ total_ordered|default:0 }}</div>
                    </div>
                </div>

                <!-- Completed -->
                <div class="time-card">
                    <div class="time-icon idle">
                        <i class="fas fa-check-circle" style="font-size: 24px;"></i>
                    </div>
                    <div class="time-content">
                        <h4>Completed</h4>
                        <div class="time-value idle" id="completedOrders">{{ completed_orders|default:0 }}</div>
                    </div>
                </div>

                <!-- In Progress -->
                <div class="time-card">
                    <div class="time-icon off">
                        <i class="fas fa-spinner" style="font-size: 24px;"></i>
                    </div>
                    <div class="time-content">
                        <h4>In Progress</h4>
                        <div class="time-value off" id="inProgressOrders">{{ in_progress_orders|default:0 }}</div>
                    </div>
                </div>
            </div>

            <!-- DIE Cards Row - Dynamic from Database -->
            <div class="die-cards-row" id="dieCardsContainer">
                {% for die_card in die_cards %}
                <div class="die-card {{ die_card.color }}">
                    <div class="die-number">
                        <i class="fas fa-circle" style="font-size: 7px;"></i> {{ die_card.die_no }}
                    </div>

                    <div class="die-info">
                        <!-- Planned Qty | C/L -->
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>Planned Qty</span>
                            <span>C/L</span>
                        </div>
                        <div
                            style="display: flex; justify-content: space-between; font-size: 27px; font-weight: bold; margin-bottom: 10px;">
                            <span>{{ die_card.planned_qty }}</span>
                            <span>{{ die_card.cut_length }}</span>
                        </div>

                        <!-- âœ… Fixed alignment for Current Prod and Prod Qty -->
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-top: 30px;">
                            <div style="display: flex; flex-direction: column; align-items: flex-start;">
                                <span class="die-label" style="margin-bottom: 4px;">Current Prod</span>
                                <span class="die-value" style="line-height: 1; font-size: 25px !important;">{{die_card.current_production|floatformat:2 }}<span style="font-size: 16px;">%</span></span>
                            </div>
                            <div style="display: flex; flex-direction: column; align-items: flex-end;">
                                <span class="die-label" style="margin-bottom: 4px;">Prod Qty</span>
                                <span class="die-value" style="line-height: 1; font-size: 25px !important;">{{ die_card.production_qty|floatformat:2 }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="die-card green">
                    <div class="die-number">No Data</div>
                    <div class="die-info">
                        <div>No production data available</div>
                    </div>
                    <div class="die-label">Current Prod</div>
                    <div class="die-value">0</div>
                </div>
                {% endfor %}
            </div>

            <!-- Charts Row -->
            <div class="charts-bottom">
                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-title">
                            <i class="fas fa-chart-bar"></i> OEE Analysis
                        </div>
                        <i class="fas fa-expand expand-icon"></i>
                    </div>
                    <div class="bar-chart-container">
                        <div class="y-axis">100 %</div>
                        <div class="bar-chart">
                            <div class="bar" style="height: 64%; width: 50px; background: #10b981;"></div>
                            <div class="bar" style="height: 75%; width: 50px; background: #f59e0b;"></div>
                            <div class="bar" style="height: 78%; width: 50px; background: #eab308;"></div>
                            <div class="bar" style="height: 100%; width: 50px; background: #3b82f6;"></div>
                        </div>
                        <div class="bar-labels">
                            <div>OEE</div>
                            <div>Availability</div>
                            <div>Performance</div>
                            <div>Quality</div>
                        </div>
                        <div class="bar-date">June 7, 08:00</div>
                    </div>
                </div>

                <!-- Line Chart -->
                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-title">
                            <i class="fas fa-chart-area"></i> Machine Operation Trend
                        </div>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <i class="fas fa-print" style="cursor: pointer; color: #666; font-size: 11px;"></i>
                            <i class="fas fa-expand expand-icon"></i>
                        </div>
                    </div>
                    <div class="line-chart-container">
                        <div class="chart-subtitle">History: Current week as per (Mon - Sun)</div>
                        <div class="line-chart">
                            <div class="chart-grid">
                                <div class="grid-line"><span class="y-label">1200</span></div>
                                <div class="grid-line"><span class="y-label">1000</span></div>
                                <div class="grid-line"><span class="y-label">800</span></div>
                                <div class="grid-line"><span class="y-label">600</span></div>
                                <div class="grid-line"><span class="y-label">400</span></div>
                                <div class="grid-line"><span class="y-label">200</span></div>
                                <div class="grid-line"><span class="y-label">0</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Sidebar -->
        <div class="right-sidebar">
            <div class="shift-info">
                <h4>Shift : {{ shift_number|default:1 }}</h4>
                <div class="shift-time">
                    Start : {% if shift_start %}{{ shift_start|date:"d/m/Y h:i" }}{% else %}N/A{% endif %}
                </div>
                <div class="shift-time">
                    End : {% if shift_end %}{{ shift_end|date:"d/m/Y h:i" }}{% else %}N/A{% endif %}
                </div>
            </div>

            <div class="machine-state">
                <div class="state-label">MACHINE STATE:</div>
                <div class="state-badge">{{ machine_state|default:"RUN" }}</div>
            </div>

            <div class="production-item">
                <div class="prod-icon on">
                    <i class="fas fa-print"></i>
                </div>
                <div class="prod-content">
                    <h5>Production<br>(Print ON)</h5>
                    <div class="prod-value on">30829 m</div>
                </div>
            </div>

            <div class="production-item">
                <div class="prod-icon off">
                    <i class="fas fa-print"></i>
                </div>
                <div class="prod-content">
                    <h5>Production<br>(Print OFF)</h5>
                    <div class="prod-value off">379 m</div>
                </div>
            </div>

            <div class="production-item">
                <div class="prod-icon bad">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="prod-content">
                    <h5>BadPart</h5>
                    <div class="prod-value bad">571 m</div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="{% static 'js/dashboard.js' %}"></script>
</body>

</html>