{% extends 'Master/Base/base.html' %}
{% load static %}

{% block content %}

<!-- Custom CSS -->
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">

<div class="dashboard-container">
    <!-- =====ðŸ”µ STICKY HEADER Contains: Logo, Calendar Icon, Filter Buttons ===== -->
    <div class="dashboard-header">
        <div class="logo">
            <i class="fas fa-chart-line alive-icon"></i> Production Dashboard
        </div>
        <div class="header-right">
            <!-- Calendar popup trigger -->
            <i class="fas fa-calendar-alt" style="font-size: 18px; cursor: pointer;" onclick="toggleCalendar()"></i>

            <!-- Today / Weekly / Monthly filter buttons -->
            <div class="filter-buttons">
                <button class="filter-btn {% if filter_type == 'today' or not filter_type %}active{% endif %}" onclick="setFilter('today')">Today</button>
                <button class="filter-btn {% if filter_type == 'weekly' %}active{% endif %}" onclick="setFilter('weekly')">Weekly</button>
                <button class="filter-btn {% if filter_type == 'monthly' %}active{% endif %}" onclick="setFilter('monthly')">Monthly</button>
            </div>
        </div>
    </div>

    <!-- =====ðŸ”µ CALENDAR POPUP OVERLAY ,Appears when clicking calendar icon ===== -->
    <div class="calendar-popup" id="calendarPopup" onclick="closeCalendarOnOutsideClick(event)">

        <!-- Close button: positioned at TOP RIGHT OF SCREEN -->
        <button class="calendar-close" onclick="toggleCalendar()">Ã—</button>

        <!-- Calendar Box -->
        <div class="calendar-container" onclick="event.stopPropagation()">

            <!-- Month / Year + Prev/Next buttons -->
            <div class="calendar-header">
                <div class="calendar-month-year" id="monthYear"></div>

                <div class="calendar-nav">
                    <button onclick="changeMonth(-1)">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button onclick="changeMonth(1)">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <!-- Day Name Grid -->
            <div class="calendar-grid">
                <div class="calendar-day-header">Sun</div>
                <div class="calendar-day-header">Mon</div>
                <div class="calendar-day-header">Tue</div>
                <div class="calendar-day-header">Wed</div>
                <div class="calendar-day-header">Thu</div>
                <div class="calendar-day-header">Fri</div>
                <div class="calendar-day-header">Sat</div>
            </div>

            <!-- Actual Calendar Dates (filled by JS) -->
            <div class="calendar-grid" id="calendarDays"></div>
        </div>
    </div>


    <!-- ====== ðŸ”µ DASHBOARD MAIN CONTENT ======= -->
    <div class="dashboard-content">

        <!-- ====== ðŸ”µ TOP THREE CARDS (Recovery, Production, Orders) ======= -->
        <div class="top-stats">

            <!-- ========== CARD 1: RECOVERY DETAILS ========== -->
            <div class="stat-card">

                <!-- Card Header -->
                <div class="stat-header">
                    <div class="stat-title">
                        <i class="fa-solid fa-arrow-trend-up"></i>
                        Recovery Details
                    </div>
                    <i class="fa-solid fa-up-right-from-square expand-icon"></i>
                </div>

                <!-- Card Values -->
                <div class="stat-content" style="justify-content: space-around; flex-wrap: nowrap;">

                    <div class="stat-item">
                        <span class="stat-value">{{ recovery_stats.recovery_percent }}%</span>
                        <span class="stat-label">Recovery</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">{{ recovery_stats.press_count }}</span>
                        <span class="stat-label">Press</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">{{ recovery_stats.total_input }}<span class="unit">kg</span></span>
                        <span class="stat-label">Input</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">{{ recovery_stats.total_output }}<span class="unit">kg</span></span>
                        <span class="stat-label">Output</span>
                    </div>
                </div>
            </div>

            <!-- ========== CARD 2: PRODUCTION ========== -->
            <div class="stat-card">

                <div class="stat-header">
                    <div class="stat-title">
                        <i class="fa-solid fa-gears"></i>
                        Production
                    </div>
                    <i class="fa-solid fa-up-right-from-square expand-icon"></i>
                </div>

                <!-- Production Stats Values -->
                <div class="production-stats">
                    <div class="prod-stat">
                        <span class="prod-value">3675<span class="unit">ft</span></span>
                        <span class="prod-label">Length</span>
                    </div>
                    <div class="prod-stat">
                        <span class="prod-value">1600<span class="unit">ft</span></span>
                        <span class="prod-label">16ft C/L</span>
                    </div>
                    <div class="prod-stat">
                        <span class="prod-value">1672<span class="unit">ft</span></span>
                        <span class="prod-label">12ft C/L</span>
                    </div>
                </div>
            </div>

            <!-- ========== CARD 3: ORDER SUMMARY ========== -->
            <div class="stat-card">

                <div class="stat-header">
                    <div class="stat-title">
                        <i class="fa-solid fa-list-check"></i>
                        Order
                    </div>
                    <i class="fa-solid fa-up-right-from-square expand-icon"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-item">
                        <span class="stat-value">32</span>
                        <span class="stat-label">Orders</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">16</span>
                        <span class="stat-label">Completed</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">8</span>
                        <span class="stat-label">In Progress</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">4</span>
                        <span class="stat-label">Cancelled</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== ðŸ”µ TABS SECTION (OEE, Downtime, Productionâ€¦) ====== -->
        <div class="tabs-section">

            <!-- Left Tab Card -->
            <div class="tab-card">

                <!-- Tab Buttons -->
                <div class="tabs">
                    <div class="tab active">OEE</div>
                    <div class="tab">Downtime</div>
                    <div class="tab">Production</div>
                    <div class="tab">Production Rate</div>
                    <div class="tab">Quality</div>
                    <div class="tab">Utilization</div>
                </div>

                <!-- Plant Circular Progress Cards -->
                <div class="plants-grid">

                    <!-- Plant 1 -->
                    <div class="plant-card">
                        <div class="plant-circle">
                            <canvas id="plant1Chart"></canvas>
                        </div>
                        <div class="plant-name">Plant - 1</div>
                        <div class="plant-trend up">â†‘ 5%</div>
                    </div>

                    <!-- Plant 2 -->
                    <div class="plant-card">
                        <div class="plant-circle">
                            <canvas id="plant2Chart"></canvas>
                        </div>
                        <div class="plant-name">Plant - 2</div>
                        <div class="plant-trend up">â†‘ 13%</div>
                    </div>

                    <!-- Plant 3 -->
                    <div class="plant-card">
                        <div class="plant-circle">
                            <canvas id="plant3Chart"></canvas>
                        </div>
                        <div class="plant-name">Plant - 3</div>
                        <div class="plant-trend down">â†“ 8%</div>
                    </div>

                    <!-- Plant 4 -->
                    <div class="plant-card">
                        <div class="plant-circle">
                            <canvas id="plant4Chart"></canvas>
                        </div>
                        <div class="plant-name">Plant - 4</div>
                        <div class="plant-trend down">â†“ 18%</div>
                    </div>
                </div>
            </div>

            <!-- RIGHT SIDE RECOVERY CARD -->
            <div class="tab-card">

                <!-- Recovery -->
                <div class="recovery-card" style="max-width: 400px;">
                    <div class="recovery-header">
                        <i class="fa-solid fa-arrow-trend-up" style="color: #64748b; font-size: 16px;"></i>
                        <span style="color: #64748b; font-size: 18px; font-weight: 500;">Recovery</span>
                    </div>
                    <div class="recovery-percentage">{{ recovery_stats.recovery_percent }}%</div>
                    <div class="recovery-chart">
                        <div class="recovery-bar">
                            <div class="recovery-bar-container">
                                <div class="recovery-bar-fill today"></div>
                            </div>
                            <div class="recovery-bar-label">Today</div>
                        </div>
                        <div class="recovery-bar">
                            <div class="recovery-bar-container">
                                <div class="recovery-bar-fill yesterday"></div>
                            </div>
                            <div class="recovery-bar-label">Yesterday</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ====== ðŸ”µ TABLES SECTION (Recovery / Orders / Production) ======= -->
        <div class="tables-section">

            <!-- Recovery Table -->
            <div class="table-card">
                <div class="table-header">
                    <div class="table-title">
                        <i class="fa-solid fa-table-list"></i>
                        Recovery Table
                    </div>
                </div>

                <!-- =========ðŸ”µ Data Table========== -->
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Die No</th>
                            <th>Cavity</th>
                            <th>Press</th>
                            <th>Input</th>
                            <th>Output</th>
                            <th>Recovery</th>
                        </tr>
                    </thead>
                    <tbody id="recoveryTableBody">
                        <tr>
                            <td colspan="6" class="text-center">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- ========ðŸ”µ ORDER TABLE ========== -->
            <div class="table-card">
                <div class="table-header">
                    <div class="table-title">
                        <i class="fa-solid fa-list-check"></i>
                        Order Table
                    </div>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Order No</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="orderTableBody">
                        <tr>
                            <td colspan="2" class="text-center">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- ==== ðŸ”µ PRODUCTION TABLE ==== -->
            <div class="table-card full-width">
                <div class="table-header">
                    <div class="table-title">
                        <i class="fa-solid fa-table-cells-large"></i>
                        Production Table
                    </div>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Die No</th>
                            <th>C/L</th>
                            <th>Operator</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="productionTableBody">
                        <tr>
                            <td colspan="4" class="text-center">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>

<!-- Pass filter type to JavaScript -->
<script>
    window.currentFilter = "{{ filter_type|default:'today' }}";
</script>

<!-- Custom JS -->
<script src="{% static 'js/dashboard.js' %}"></script>

{% endblock %}